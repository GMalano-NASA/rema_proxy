<link rel="stylesheet" type="text/css" href="css/datatables.min.css" />

<script type="text/javascript" src="js/datatables.min.js"></script>


<div id="new_tool_div" style="overflow: hidden; width: 100%;">
	<form>
		<div>
			<div style="padding-bottom: 10px;">
				<label>Tool Name: <input type="text" id="tool_name" /></label>
			</div>
			<div style="padding-bottom: 10px;">
				<label>Offset X: <input type="text" id="offset_x_" /></label>
			</div>
			<div style="padding-bottom: 10px;">
				<label>Offset Y: <input type="text" id="offset_y_" /></label>
			</div>
			<div style="padding-bottom: 10px; padding-top: 10px;">
				<textarea id="new_tool_logs" style="width: 100%"></textarea>
			</div>
		</div>
	</form>
</div>

<div id="tool_tab"
	style="overflow: scroll; width: 100%; position: relative;">
	<input type="button" value="New Tool" id="new_tool_btn" />

	<table id="tool_table" class="datatables display" style="width: 100%">
		<thead>
			<tr>
				<th>Name</th>
				<th>Offset X</th>
				<th>Offset Y</th>
				<th>Options</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>

<script type="text/javascript">
	var table;
	
	function load_tools() {

		table = $('#tool_table').DataTable(
				{
					ajax : {
						method : "post",
						url : "/json/tools_list",
						dataSrc : 'tools',
					},
					columns : [
							{
								data : 'name'
							},
							{
								data : 'offset_x'
							},
							{
								data : 'offset_y'
							},
							{
								data : null,
								render : function(data, type, row) {
									return '<a class="ui-icon ui-icon-trash" href="#" data-name="'
											+ row.name + '">' + row.name
											+ '</a>';
								}
							}, ]
				});
		
		table.on('draw.dt', function(e, settings, json, xhr) {			
			$(".ui-icon-trash").on("click", function() {
				console.log($(this).data);
				var tool_name = $(this).data("name");
				
				var confirm_action = confirm("Are you sure you want to delete " + tool_name + " ?");
		        if (confirm_action) {
					$.post('/json/tool_delete', JSON.stringify({
						tool_name : tool_name,
					}), function(data) {
						if (data.success) {
							table.ajax.reload();
						} else {
								alert("data.logs");					
						}
					});
		        }
			});

		})
	}

	$(function() {
		load_tools();
		$("#new_tool_btn").click(function() {
			$("#new_tool_div").dialog("open");
		});
	});

	function create_dialog() {
		var dialog = $("#new_tool_div").dialog({
			autoOpen : false,
			title : "New Tool",
			//modal : true,
			buttons : [ {
				text : "Create",
				//icon: "ui-icon-heart",
				click : function(event) {
					$.post('/json/tool_create', JSON.stringify({
						tool_name : $("#tool_name").val(),
						offset_x : $("#offset_x_").val(),
						offset_y : $("#offset_y_").val(),
					}), function(data) {
						$("#new_tool_logs").val(data.logs);
						if (data.success) {
							$(event.target).hide(); // Hides the "Create" button
						}
					});

				}
			}, {
				text : "Close",
				//icon: "ui-icon-heart",
				click : function(event) {
					dialog.find("form")[0].reset();
					dialog.dialog("close");
					dialog.dialog("destroy");
					create_dialog();
					table.ajax.reload();
				}
			} ]
		});
	}

	$(function() {
		create_dialog();
	});
</script>